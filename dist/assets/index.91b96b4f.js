import{C as e,B as t,S as r,R as n,a as c}from"./vendor.8063de71.js";!function(e=".",t="__import__"){try{self[t]=new Function("u","return import(u)")}catch(r){const n=new URL(e,location),c=e=>{URL.revokeObjectURL(e.src),e.remove()};self[t]=e=>new Promise(((r,o)=>{const a=new URL(e,n);if(self[t].moduleMap[a])return r(self[t].moduleMap[a]);const s=new Blob([`import * as m from '${a}';`,`${t}.moduleMap['${a}']=m;`],{type:"text/javascript"}),i=Object.assign(document.createElement("script"),{type:"module",src:URL.createObjectURL(s),onerror(){o(new Error(`Failed to import: ${e}`)),c(i)},onload(){r(self[t].moduleMap[a]),c(i)}});document.head.appendChild(i)})),self[t].moduleMap={}}}("/assets/");const o=t=>{const[r,n]=e.useState("");return e.createElement("div",null,e.createElement("button",{onClick:async e=>{e.preventDefault();const r=await fetch("https://exp.goleko.com/create"),{room_id:c}=await r.json();n(c),t.history.push(`/room/${c}`)}},"Create Room"),r&&e.createElement("p",null,"Room ID: ",r))},a=t=>{const[r]=e.useState(t.match.params.roomID),n=e.useRef(),c=e.useRef(),o=e.useRef(),a=e.useRef(),[s,i]=e.useState(!1),l=async()=>{try{const e={audio:!0,video:{facingMode:"user"}};return await navigator.mediaDevices.getUserMedia(e)}catch(e){console.log(e)}};e.useEffect((()=>{l().then((e=>{n.current.srcObject=e,a.current=new WebSocket(`wss://exp.goleko.com/join?roomID=${r}`),a.current.addEventListener("open",(()=>{a.current.send(JSON.stringify({join:!0}))})),a.current.addEventListener("message",(async e=>{const t=JSON.parse(e.data);if(t.join&&u(),t.offer&&d(t.offer),t.answer&&(console.log("Receiving Answer"),o.current.setRemoteDescription(new RTCSessionDescription(t.answer))),t.iceCandidate){console.log("Receiving and Adding ICE Candidate");try{await o.current.addIceCandidate(t.iceCandidate)}catch(r){console.log("Error Receiving ICE Candidate",r)}}}))}))}),[r]);const d=async e=>{console.log("Received Offer, Creating Answer"),o.current=m(),await o.current.setRemoteDescription(new RTCSessionDescription(e)),n.current.srcObject.getTracks().forEach((e=>{o.current.addTrack(e,n.current.srcObject)}));const t=await o.current.createAnswer();await o.current.setLocalDescription(t),a.current.send(JSON.stringify({answer:o.current.localDescription}))},u=()=>{console.log("Calling Other User"),o.current=m(),n.current.srcObject.getTracks().forEach((e=>{o.current.addTrack(e,n.current.srcObject)}))},m=()=>{console.log("Creating Peer Connection");const e=new RTCPeerConnection({iceServers:[{urls:"stun:stun.l.google.com:19302"}]});return e.onnegotiationneeded=f,e.onicecandidate=g,e.ontrack=p,e},f=async()=>{console.log("Creating Offer");try{const e=await o.current.createOffer();await o.current.setLocalDescription(e),a.current.send(JSON.stringify({offer:o.current.localDescription}))}catch(e){console.error("Error creating offer:",e)}},g=e=>{console.log("Found Ice Candidate"),e.candidate&&(console.log(e.candidate),a.current.send(JSON.stringify({iceCandidate:e.candidate})))},p=e=>{console.log("Received Tracks"),c.current.srcObject=e.streams[0]};return e.createElement("div",null,e.createElement("p",null,"Room ID: ",r),e.createElement("video",{autoPlay:!0,controls:!0,ref:n}),e.createElement("video",{autoPlay:!0,controls:!0,ref:c}),e.createElement("button",{onClick:async()=>{if(s){const e=await l();o.current.getSenders().forEach((t=>{"video"===t.track.kind&&t.replaceTrack(e.getTracks()[1])}))}else{const e=await(async()=>{try{return await navigator.mediaDevices.getDisplayMedia({video:!0})}catch(e){console.log(e)}})();o.current.getSenders().forEach((t=>{"video"===t.track.kind&&t.replaceTrack(e.getTracks()[0])}))}i((e=>!e))}},s?"Stop Screen Share":"Start Screen Share"))};function s(){return e.createElement("div",{className:"App"},e.createElement(t,null,e.createElement(r,null,e.createElement(n,{path:"/",exact:!0,component:o}),e.createElement(n,{path:"/room/:roomID",component:a}))))}c.render(e.createElement(e.StrictMode,null,e.createElement(s,null)),document.getElementById("root"));
