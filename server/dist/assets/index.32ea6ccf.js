import{C as e,B as r,S as t,R as n,a as o}from"./vendor.8063de71.js";!function(e=".",r="__import__"){try{self[r]=new Function("u","return import(u)")}catch(t){const n=new URL(e,location),o=e=>{URL.revokeObjectURL(e.src),e.remove()};self[r]=e=>new Promise(((t,c)=>{const a=new URL(e,n);if(self[r].moduleMap[a])return t(self[r].moduleMap[a]);const s=new Blob([`import * as m from '${a}';`,`${r}.moduleMap['${a}']=m;`],{type:"text/javascript"}),i=Object.assign(document.createElement("script"),{type:"module",src:URL.createObjectURL(s),onerror(){c(new Error(`Failed to import: ${e}`)),o(i)},onload(){t(self[r].moduleMap[a]),o(i)}});document.head.appendChild(i)})),self[r].moduleMap={}}}("/assets/");const c=r=>e.createElement("div",null,e.createElement("button",{onClick:async e=>{e.preventDefault();const t=await fetch("https://exp.goleko.com/create"),{room_id:n}=await t.json();r.history.push(`/room/${n}`)}},"Create Room")),a=r=>{const t=e.useRef(),n=e.useRef(),o=e.useRef(),c=e.useRef({}),a=()=>{Object.keys(c.current).forEach((e=>{c.current[e].close()})),t.current.srcObject=null};e.useEffect((()=>((async()=>{try{const e=await navigator.mediaDevices.getUserMedia({video:!0,audio:!0});return t.current.srcObject=e,n.current=e,e}catch(e){console.error("Error accessing camera:",e)}})().then((e=>{o.current=new WebSocket(`wss://exp.goleko.com/join?roomID=${r.match.params.roomID}`),o.current.addEventListener("open",(()=>{o.current.send(JSON.stringify({join:!0}))})),o.current.addEventListener("message",(async e=>{const r=JSON.parse(e.data);if(r.join&&Object.keys(c.current).forEach((e=>{i(e)})),r.offer&&s(r.offer,r.from),r.answer&&(console.log("Receiving Answer"),c.current[r.from].setRemoteDescription(new RTCSessionDescription(r.answer))),r.iceCandidate){console.log("Receiving and Adding ICE Candidate");try{await c.current[r.from].addIceCandidate(r.iceCandidate)}catch(t){console.log("Error Receiving ICE Candidate",t)}}})),o.current.addEventListener("close",a)})),()=>{o.current&&o.current.close(),Object.keys(c.current).forEach((e=>{c.current[e].close()}))})),[]);const s=async(e,r)=>{console.log("Received Offer, Creating Answer"),c.current[r]=l(r),await c.current[r].setRemoteDescription(new RTCSessionDescription(e)),n.current.getTracks().forEach((e=>{c.current[r].addTrack(e,n.current)}));const t=await c.current[r].createAnswer();await c.current[r].setLocalDescription(t),o.current.send(JSON.stringify({answer:c.current[r].localDescription,to:r}))},i=e=>{console.log("Calling Other User"),c.current[e]=l(e),n.current.getTracks().forEach((r=>{c.current[e].addTrack(r,n.current)}))},l=e=>{console.log("Creating Peer Connection for User: "+e);const r=new RTCPeerConnection({iceServers:[{urls:"stun:stun.l.google.com:19302"}]});return r.onnegotiationneeded=()=>d(e),r.onicecandidate=r=>u(r,e),r.ontrack=r=>m(r,e),r},d=async e=>{console.log("Creating Offer for User: "+e);try{const r=await c.current[e].createOffer();await c.current[e].setLocalDescription(r),o.current.send(JSON.stringify({offer:c.current[e].localDescription,to:e}))}catch(r){}},u=(e,r)=>{console.log("Found Ice Candidate for User: "+r),e.candidate&&o.current.send(JSON.stringify({iceCandidate:e.candidate,to:r}))},m=(e,r)=>{console.log("Received Tracks for User: "+r);const t=document.createElement("video");t.autoPlay=!0,t.controls=!0,t.srcObject=e.streams[0],document.body.appendChild(t)};return e.createElement("div",null,e.createElement("video",{autoPlay:!0,controls:!0,ref:t}))};function s(){return e.createElement("div",{className:"App"},e.createElement(r,null,e.createElement(t,null,e.createElement(n,{path:"/",exact:!0,component:c}),e.createElement(n,{path:"/room/:roomID",component:a}))))}o.render(e.createElement(e.StrictMode,null,e.createElement(s,null)),document.getElementById("root"));
