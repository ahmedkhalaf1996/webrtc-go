import{C as e,B as t,S as n,R as r,a as o}from"./vendor.8063de71.js";!function(e=".",t="__import__"){try{self[t]=new Function("u","return import(u)")}catch(n){const r=new URL(e,location),o=e=>{URL.revokeObjectURL(e.src),e.remove()};self[t]=e=>new Promise(((n,c)=>{const a=new URL(e,r);if(self[t].moduleMap[a])return n(self[t].moduleMap[a]);const s=new Blob([`import * as m from '${a}';`,`${t}.moduleMap['${a}']=m;`],{type:"text/javascript"}),i=Object.assign(document.createElement("script"),{type:"module",src:URL.createObjectURL(s),onerror(){c(new Error(`Failed to import: ${e}`)),o(i)},onload(){n(self[t].moduleMap[a]),o(i)}});document.head.appendChild(i)})),self[t].moduleMap={}}}("/assets/");const c=t=>e.createElement("div",null,e.createElement("button",{onClick:async e=>{e.preventDefault();const n=await fetch("https://exp.goleko.com/create"),r=await n.json(),{room_id:o}=r,c=r;console.log("roomid",o,"res",c),t.history.push(`/room/${o}`)}},"Create Room")),a=t=>{const n=e.useRef(),r=e.useRef(),o=e.useRef(),c=e.useRef(),[a,s]=e.useState([]);e.useEffect((()=>{(async()=>{const e={audio:!0,video:{deviceId:(await navigator.mediaDevices.enumerateDevices()).filter((e=>"videoinput"==e.kind))[0].deviceId}};try{return await navigator.mediaDevices.getUserMedia(e)}catch(t){console.log(t)}})().then((e=>{n.current.srcObject=e,r.current=e,c.current=new WebSocket(`wss://exp.goleko.com/join?roomID=${t.match.params.roomID}`),c.current.addEventListener("open",(()=>{c.current.send(JSON.stringify({join:!0}))})),c.current.addEventListener("message",(async e=>{const t=JSON.parse(e.data);if(t.join&&d(),t.offer&&i(t.offer),t.answer&&(console.log("Receiving Answer"),o.current.setRemoteDescription(new RTCSessionDescription(t.answer))),t.iceCandidate){console.log("Receiving and Adding ICE Candidate");try{await o.current.addIceCandidate(t.iceCandidate)}catch(n){console.log("Error Receiving ICE Candidate",n)}}t.disconnect&&(console.log("User disconnected",t),p(t.disconnect))}))}))}),[]);const i=async e=>{console.log("Received Offer, Creating Answer"),o.current=l(),await o.current.setRemoteDescription(new RTCSessionDescription(e)),r.current.getTracks().forEach((e=>{o.current.addTrack(e,r.current)}));const t=await o.current.createAnswer();await o.current.setLocalDescription(t),c.current.send(JSON.stringify({answer:o.current.localDescription}))},d=()=>{console.log("Calling Other User"),o.current=l(),r.current.getTracks().forEach((e=>{o.current.addTrack(e,r.current)}))},l=()=>{console.log("Creating Peer Connection");const e=new RTCPeerConnection({iceServers:[{urls:"stun:stun.l.google.com:19302"}]});return e.onnegotiationneeded=u,e.onicecandidate=m,e.ontrack=f,e},u=async()=>{console.log("Creating Offer");try{const e=await o.current.createOffer();await o.current.setLocalDescription(e),c.current.send(JSON.stringify({offer:o.current.localDescription}))}catch(e){}},m=e=>{console.log("Found Ice Candidate"),e.candidate&&(console.log(e.candidate),c.current.send(JSON.stringify({iceCandidate:e.candidate})))},f=e=>{e.streams&&e.streams.length>0?s((t=>[...t,{id:e.track.id,stream:e.streams[0]}])):console.error("Stream not available")};e.useEffect((()=>{const e=document.getElementById("container");e.innerHTML="",a.forEach((t=>{const n=document.createElement("video");n.key=t.id,n.autoPlay=!0,n.controls=!0,n.srcObject=t.stream,e.appendChild(n)}))}),[a]);const p=e=>{s((t=>t.filter((t=>t.id!==e))))};return e.createElement("div",null,e.createElement("video",{autoPlay:!0,controls:!0,ref:n}),e.createElement("div",{id:"container"}))};function s(){return e.createElement("div",{className:"App"},e.createElement(t,null,e.createElement(n,null,e.createElement(r,{path:"/",exact:!0,component:c}),e.createElement(r,{path:"/room/:roomID",component:a}))))}o.render(e.createElement(e.StrictMode,null,e.createElement(s,null)),document.getElementById("root"));
