import{C as e,B as t,S as n,R as r,a as o}from"./vendor.8063de71.js";!function(e=".",t="__import__"){try{self[t]=new Function("u","return import(u)")}catch(n){const r=new URL(e,location),o=e=>{URL.revokeObjectURL(e.src),e.remove()};self[t]=e=>new Promise(((n,c)=>{const a=new URL(e,r);if(self[t].moduleMap[a])return n(self[t].moduleMap[a]);const s=new Blob([`import * as m from '${a}';`,`${t}.moduleMap['${a}']=m;`],{type:"text/javascript"}),i=Object.assign(document.createElement("script"),{type:"module",src:URL.createObjectURL(s),onerror(){c(new Error(`Failed to import: ${e}`)),o(i)},onload(){n(self[t].moduleMap[a]),o(i)}});document.head.appendChild(i)})),self[t].moduleMap={}}}("/assets/");const c=t=>e.createElement("div",null,e.createElement("button",{onClick:async e=>{e.preventDefault();const n=await fetch("https://exp.goleko.com/create"),{room_id:r}=await n.json();t.history.push(`/room/${r}`)}},"Create Room")),a=t=>{const n=e.useRef(),r=e.useRef(),o=e.useRef(),c=e.useRef(),a=e.useRef();e.useEffect((()=>{(async()=>{const e=(await navigator.mediaDevices.enumerateDevices()).filter((e=>"videoinput"==e.kind));console.log("cameras",e);const t={audio:!0,video:{deviceId:e[0].deviceId}};try{return await navigator.mediaDevices.getUserMedia(t)}catch(n){console.log(n)}})().then((e=>{n.current.srcObject=e,r.current=e,a.current=new WebSocket(`wss://exp.goleko.com/join?roomID=${t.match.params.roomID}`),a.current.addEventListener("open",(()=>{a.current.send(JSON.stringify({join:!0}))})),a.current.addEventListener("message",(async e=>{const t=JSON.parse(e.data);if(t.join&&i(),t.offer&&s(t.offer),t.answer&&(console.log("Receiving Answer"),c.current.setRemoteDescription(new RTCSessionDescription(t.answer))),t.iceCandidate){console.log("Receiving and Adding ICE Candidate");try{await c.current.addIceCandidate(t.iceCandidate)}catch(n){console.log("Error Receiving ICE Candidate",n)}}}))}))}));const s=async e=>{console.log("Received Offer, Creating Answer"),c.current=l(),await c.current.setRemoteDescription(new RTCSessionDescription(e)),r.current.getTracks().forEach((e=>{c.current.addTrack(e,r.current)}));const t=await c.current.createAnswer();await c.current.setLocalDescription(t),a.current.send(JSON.stringify({answer:c.current.localDescription}))},i=()=>{console.log("Calling Other User"),c.current=l(),r.current.getTracks().forEach((e=>{c.current.addTrack(e,r.current)}))},l=()=>{console.log("Creating Peer Connection");const e=new RTCPeerConnection({iceServers:[{urls:"stun:stun.l.google.com:19302"}]});return e.onnegotiationneeded=d,e.onicecandidate=u,e.ontrack=m,e},d=async()=>{console.log("Creating Offer");try{const e=await c.current.createOffer();await c.current.setLocalDescription(e),a.current.send(JSON.stringify({offer:c.current.localDescription}))}catch(e){}},u=e=>{console.log("Found Ice Candidate"),e.candidate&&(console.log(e.candidate),a.current.send(JSON.stringify({iceCandidate:e.candidate})))},m=e=>{console.log("Received Tracks"),console.log("handleTrackEvent",e),o.current.srcObject=e.streams[0]};return e.createElement("div",null,e.createElement("video",{autoPlay:!0,controls:!0,ref:n}),e.createElement("video",{autoPlay:!0,controls:!0,ref:o}))};function s(){return e.createElement("div",{className:"App"},e.createElement(t,null,e.createElement(n,null,e.createElement(r,{path:"/",exact:!0,component:c}),e.createElement(r,{path:"/room/:roomID",component:a}))))}o.render(e.createElement(e.StrictMode,null,e.createElement(s,null)),document.getElementById("root"));
